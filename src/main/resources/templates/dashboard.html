<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Кредитование - Панель управления</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <script th:src="@{/js/dashboard.js}" defer></script>
    <script th:src="@{/js/create-loan.js}" defer></script>
    <script th:src="@{/js/calculate-schedule.js}" defer></script>
    <script th:src="@{/js/view-summary.js}" defer></script>
    <script th:src="@{/js/rate-tab.js}" defer></script>
</head>
<body>

<h2 style="text-align: center; color: #4b3ca3;">Панель управления</h2>

<div class="tabs">
    <button class="tab-button" onclick="showTab('create')">Заведение кредита</button>
    <button class="tab-button" onclick="showTab('calculate')">Расчет погашения кредита</button>
    <button class="tab-button" onclick="showTab('view')">Просмотр результата</button>
    <button class="tab-button" onclick="showTab('rateTab')">Изменение ставки</button>
</div>

<!-- Вкладка Заведение кредита -->
<div id="create" class="tab-content">
    <h3>Заведение кредита</h3>
    <div class="form-wrapper">
        <form id="loanForm">
            <div class="form-row">
                <label for="clientFullName">ФИО клиента:</label>
                <input type="text" id="clientFullName" name="clientFullName" required>
            </div>

            <!-- УДАЛЕНО поле ФИО сотрудника -->

            <div class="form-row">
                <label for="loanAmount">Сумма кредита:</label>
                <input type="number" id="loanAmount" name="loanAmount" step="0.01" required>
            </div>

            <div class="form-row">
                <label for="rate">Процентная ставка (%):</label>
                <input type="number" id="rate" name="rate" step="0.01" required>
            </div>

            <div class="form-row">
                <label for="startDate">Дата начала:</label>
                <input type="date" id="startDate" name="startDate" required>
            </div>

            <div class="form-row">
                <label for="endDate">Дата окончания:</label>
                <input type="date" id="endDate" name="endDate" required>
            </div>

            <div class="form-row">
                <label for="paymentType">Тип платежа:</label>
                <select id="paymentType" name="paymentType" required>
                    <option value="ANNUITY">Аннуитетный</option>
                    <option value="DIFFERENTIATED">Дифференцированный</option>
                </select>
            </div>

            <div class="form-actions">
                <button type="submit">Создать кредит</button>
            </div>
        </form>

        <div id="successMessage" class="success-message" style="display: none;">
            Кредит успешно оформлен!
            <button onclick="document.getElementById('successMessage').style.display='none'; document.getElementById('loanForm').reset();">
                Закрыть
            </button>
        </div>
    </div>
</div>


<!-- Вкладка Расчет погашения кредита -->
<div id="calculate" class="tab-content" style="display: none;">
    <h3>Расчет погашения кредита</h3>
    <form id="calcForm">
        <div class="form-row">
            <label for="contractId">ID договора:</label>
            <input type="number" id="contractId" required>
        </div>
        <div class="form-actions">
            <button type="submit">Рассчитать график</button>
        </div>
    </form>
    <div id="calcSuccess" class="success-message" style="display: none;">
        График успешно пересчитан!
        <button onclick="document.getElementById('calcSuccess').style.display='none'; document.getElementById('calcForm').reset();">Закрыть</button>
    </div>

    <!-- Блок отображения рассчитанных платежей -->
    <div id="calcResultContainer" style="display: none; margin-top: 30px;">
        <h4>Рассчитанный график</h4>
        <table class="styled-table">
            <thead>
            <tr>
                <th>Дата платежа</th>
                <th>Основной долг</th>
                <th>Проценты</th>
                <th>Общая сумма</th>
                <th>Погашен</th>
            </tr>
            </thead>
            <tbody id="calcResultTableBody"></tbody>
        </table>
    </div>
</div>


<!-- Вкладка Просмотр результата -->
<div id="view" class="tab-content" style="display: none;">
    <h3>Просмотр результата</h3>

    <form id="viewForm">
        <div class="form-row">
            <label for="viewContractId">ID договора:</label>
            <input type="number" id="viewContractId" required>
        </div>
        <div class="form-actions">
            <button type="submit">Показать результат</button>
        </div>
    </form>

    <div id="summaryContainer" style="margin-top: 30px; display: none;">
        <h4>Сводная информация</h4>
        <table class="styled-table">
            <thead>
            <tr>
                <th>Погашено основного долга</th>
                <th>Погашено процентов</th>
                <th>Остаток долга</th>
                <th>Общая переплата</th>
            </tr>
            </thead>
            <tbody id="summaryTableBody"></tbody>
        </table>
    </div>

    <div id="paymentListContainer" style="margin-top: 30px; display: none;">
        <h4>Платежи по договору</h4>
        <table class="styled-table">
            <thead>
            <tr>
                <th>Дата платежа</th>
                <th>Основной долг</th>
                <th>Проценты</th>
                <th>Общая сумма</th>
                <th>Погашен</th>
            </tr>
            </thead>
            <tbody id="paymentTableBody"></tbody>
        </table>
    </div>
</div>

<!-- Вкладка Изменение ставки -->
<div id="rateTab" class="tab-content" style="display: none;">
    <h3>Изменение процентной ставки</h3>

    <form id="rateForm">
        <div class="form-row">
            <label for="rateContractId">ID договора:</label>
            <input type="number" id="rateContractId" required>
        </div>
        <div class="form-row">
            <label for="newRate">Новая ставка (%):</label>
            <input type="number" step="0.01" id="newRate" required>
        </div>
        <div class="form-row">
            <label for="rateStartDate">Дата начала действия:</label>
            <input type="date" id="rateStartDate" required>
        </div>
        <div class="form-actions">
            <button type="submit">Изменить ставку</button>
            <button type="button" id="loadRateHistory">Показать историю ставок</button>
        </div>
    </form>

    <div id="rateSuccess" class="success-message" style="display: none; margin-top: 10px;">
        Ставка успешно изменена!
        <button onclick="document.getElementById('rateSuccess').style.display='none'">Закрыть</button>
    </div>

    <div id="rateHistoryContainer" style="display: none; margin-top: 30px;">
        <h4>История процентных ставок</h4>
        <table class="styled-table">
            <thead>
            <tr>
                <th>Дата начала</th>
                <th>Ставка (%)</th>
                <th>Сотрудник</th>
            </tr>
            </thead>
            <tbody id="rateHistoryTableBody"></tbody>
        </table>
    </div>
</div>

</body>
</html>
